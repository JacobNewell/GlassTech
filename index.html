<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–§–æ—Ä–º–∞ –¥–ª—è –∞–≤—Ç–æ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    form { background: #fff; padding: 20px; border-radius: 8px; max-width: 400px; margin: auto; }
    input, textarea { display: block; margin-bottom: 10px; width: 100%; padding: 8px; }
    button { padding: 10px; background: #2b8aed; color: white; border: none; border-radius: 4px; cursor: pointer; }
    label { display: block; margin: 6px 0; }
  </style>
  <!-- Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <script>
  window.Telegram.WebApp.ready();

  const user = window.Telegram.WebApp.initDataUnsafe?.user;

  if (user) {
    console.log("–Ü–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:", user.first_name, user.last_name);
    console.log("Username:", user.username);
    console.log("ID:", user.id);
  } else {
    console.log("–î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ ‚Äî –º–æ–∂–ª–∏–≤–æ, –∑–∞–ø—É—Å–∫ –Ω–µ —á–µ—Ä–µ–∑ Web App.");
  }
</script>
  <h2>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∞–≤—Ç–æ</h2>
  <form id="carForm">
    <input type="text" name="brand" placeholder="–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ" required />
    <input type="text" name="model" placeholder="–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ" required />
    <input type="number" name="year" placeholder="–†—ñ–∫ –≤–∏–ø—É—Å–∫—É" required />
    <input type="text" name="bodyType" placeholder="–í–∏–¥ –∫—É–∑–æ–≤–∞" required />

    <fieldset>
      <legend>–ù–∞—è–≤–Ω—ñ—Å—Ç—å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è:</legend>
      <label><input type="checkbox" name="options" value="–î–∞—Ç—á–∏–∫ –¥–æ—â—É" /> –î–∞—Ç—á–∏–∫ –¥–æ—â—É</label>
      <label><input type="checkbox" name="options" value="–ó–∞–≥–∞–ª—å–Ω–∏–π –æ–±—ñ–≥—Ä—ñ–≤" /> –ó–∞–≥–∞–ª—å–Ω–∏–π –æ–±—ñ–≥—Ä—ñ–≤</label>
      <label><input type="checkbox" name="options" value="–û–±—ñ–≥—Ä—ñ–≤ –¥–≤—ñ—Ä–Ω–∏–∫—ñ–≤" /> –û–±—ñ–≥—Ä—ñ–≤ –¥–≤—ñ—Ä–Ω–∏–∫—ñ–≤</label>
      <label><input type="checkbox" name="options" value="–ö–∞–º–µ—Ä–∞" /> –ö–∞–º–µ—Ä–∞</label>
      <label><input type="checkbox" name="options" value="–ê–Ω—Ç–µ–Ω–∞" /> –ê–Ω—Ç–µ–Ω–∞</label>
      <label><input type="checkbox" name="options" value="–ù—ñ—á–æ–≥–æ –∑ –ø–µ—Ä–µ–ª—ñ—á–µ–Ω–æ–≥–æ" id="noneOption" /> –ù—ñ—á–æ–≥–æ –∑ –ø–µ—Ä–µ–ª—ñ—á–µ–Ω–æ–≥–æ</label>
    </fieldset>

    <label>–ü–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ, –ø—Ä–∏–∫—Ä—ñ–ø—ñ—Ç—å —á—ñ—Ç–∫–µ —Ñ–æ—Ç–æ –∞–≤—Ç–æ –∑ –≤—É–ª–∏—Ü—ñ:</label>
    <input type="file" name="photo" id="photoInput" accept="image/*" />

    <button type="submit">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
  </form>

  <script>
    if (window.Telegram && window.Telegram.WebApp) {
      window.Telegram.WebApp.ready();
    }

    const botToken = "7383504698:AAEsV0m8H2KhqlrefNCimaT3Jk14qQEAsEo";
    const groupChatId = "-1002566804604";

    document.getElementById('noneOption').addEventListener('change', function() {
      if (this.checked) {
        document.querySelectorAll('input[name="options"]').forEach(el => {
          if (el !== this) el.checked = false;
        });
      }
    });

    document.querySelectorAll('input[name="options"]').forEach(el => {
      if (el.id !== 'noneOption') {
        el.addEventListener('change', () => {
          if (el.checked) {
            document.getElementById('noneOption').checked = false;
          }
        });
      }
    });

    document.getElementById('carForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = new FormData(e.target);

      const selectedOptions = Array.from(document.querySelectorAll('input[name="options"]:checked'))
        .map(el => el.value)
        .join(', ') || '–ù–µ –æ–±—Ä–∞–Ω–æ';

      let authorLink = 'üßë –ö–ª—ñ—î–Ω—Ç: –ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ';
      if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) {
        const tgUser = window.Telegram.WebApp.initDataUnsafe.user;
        authorLink = tgUser?.username
          ? `üßë –ö–ª—ñ—î–Ω—Ç: [${tgUser.first_name}](https://t.me/${tgUser.username})`
          : tgUser?.first_name
            ? `üßë –ö–ª—ñ—î–Ω—Ç: ${tgUser.first_name} (–±–µ–∑ username)`
            : `üßë –ö–ª—ñ—î–Ω—Ç: –ù–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ`;
      }

      const messageText = `
üöó *–ù–æ–≤–∞ –∑–∞—è–≤–∫–∞:*
${authorLink}
*–ú–∞—Ä–∫–∞:* ${form.get('brand')}
*–ú–æ–¥–µ–ª—å:* ${form.get('model')}
*–†—ñ–∫:* ${form.get('year')}
*–ö—É–∑–æ–≤:* ${form.get('bodyType')}
*–ù–∞—è–≤–Ω—ñ—Å—Ç—å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è:* ${selectedOptions}
      `.trim();

      const photoFile = document.getElementById('photoInput').files[0];

      if (photoFile) {
        const formDataToSend = new FormData();
        formDataToSend.append("chat_id", groupChatId);
        formDataToSend.append("caption", messageText);
        formDataToSend.append("photo", photoFile);

        await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
          method: 'POST',
          body: formDataToSend
        });
      } else {
        await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: groupChatId,
            text: messageText,
            parse_mode: "Markdown"
          })
        });
      }

      alert('–§–æ—Ä–º–∞ —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∞! –î—è–∫—É—î–º–æ üòä');
    });
  </script>

</body>
</html>
